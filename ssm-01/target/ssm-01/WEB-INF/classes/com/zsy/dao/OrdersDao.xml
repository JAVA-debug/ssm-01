<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zsy.dao.OrdersDao">
    <select id="findAll" resultType="Orders">
        select * from orders where userId = #{userId}
    </select>

    <select id="findAllItem" resultType="OrderItem">
        select * from order_item where orderId in (select id from orders where userId = #{userId})
    </select>

    <select id="findOne" resultType="Integer">
        SELECT COUNT(productId) from order_item WHERE orderId = #{orderId}
    </select>
    
    <insert id="addOrder" useGeneratedKeys="true" keyProperty="id">
        insert into orders (sn,userId,address,money,productNum,status,createTime) values (#{sn},#{userId},#{address},#{money},#{productNum},#{status},NOW());
    </insert>

    <insert id="addItem" useGeneratedKeys="true" keyProperty="id">
        insert into order_item (productId,orderId,name,imageUrl,price,num,money) values (#{productId},#{orderId},#{name},#{imageUrl},#{price},#{num},#{money});
    </insert>
</mapper>